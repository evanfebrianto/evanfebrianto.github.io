<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Path Planning | Evan Febrianto</title> <meta name="author" content="Evan Febrianto"/> <meta name="description" content="C++, Unity, WebSocket"/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/avatar.png"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://evanfebrianto.github.io/projects/sdc-path-planning/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://evanfebrianto.github.io/"><span class="font-weight-bold">Evan</span> Febrianto</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/assets/pdf/resume.pdf">Resume</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Path Planning</h1> <p class="post-description">C++, Unity, WebSocket</p> <p class="post-github"> <a href="https://github.com/evanfebrianto/Udacity-PathPlanning" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> <span-github-link> View on GitHub </span-github-link> </a> </p> </header> <article> <h3 id="general-info">General Info</h3> <p>The goals / steps of this project are the following:</p> <ul> <li>Implement a path planning algorithm and finite state machine</li> <li>Use localization and sensor fusion data and waypoints to plan a safe path in traffic at 50mph</li> <li>Develop an understanding of Frenet coordinates and use them to perform maneuvers (e.g. lane switches)</li> <li>Use the simulator to test the path planning algorithm and finite state machine</li> </ul> <h3 id="approach">Approach</h3> <p>This project utilizes a Frenet coordinates, a finite state machine, and a spline object to plan the path of the autonomous car in the simulator.</p> <ul> <li> <code class="language-plaintext highlighter-rouge">main.cpp</code> - communicates with the simulator, contains the finite state machine and generates a path using localization and sensor fusion data</li> <li> <code class="language-plaintext highlighter-rouge">helpers.h</code> - contains useful functions for the path planning implementation</li> <li> <code class="language-plaintext highlighter-rouge">spline.h</code> - imported spline object to create smooth trajectories using points</li> <li> <code class="language-plaintext highlighter-rouge">json.hpp</code> - imported default JSON file format</li> </ul> <h4 id="constraints-during-design">Constraints during Design</h4> <ul> <li>Drives over 5 miles without any incidents</li> <li>Stays below the speed limit of 50 mph</li> <li>Limits total acceleration and jerk below 10 m/s^2 and 10 ms^3 respectively</li> <li>No collisions with other traffic</li> <li>Stays in its lane unless lane changing (taking &lt; 3s to change lanes)</li> <li>Changes lanes when traffic is slow and a nearby lane is free</li> </ul> <h4 id="finite-state-machine">Finite State Machine</h4> <table class="table table-striped"> <thead class="thead-dark"> <tr> <th scope="col">State 0</th> <th scope="col">State 1</th> <th scope="col">State 2</th> </tr> </thead> <tbody> <tr> <td>When there is no car ahead, the car will accelerate to its max speed</td> <td>Vehicle is following the car ahead without tailgating</td> <td>Prepare to switch lanes and checking for gaps in traffic</td> </tr> </tbody> </table> <ul> <li>State 0 -&gt; State 1: Car is spotted within 40 meters ahead of the car in the current lane</li> <li>State 1 -&gt; State 2: Car in front is slow</li> <li>State 2 -&gt; State 0: Successfully changed lanes</li> </ul> <p>A lane change is performed when there are no cars within 30m to the left and/or right lane of the current car’s lane. The speed of the adjacent lanes’ traffic ahead determines the lane to change to if both have a sufficient gap in traffic. Additionally, a delay is implemented to prevent consecutive lane changes from occuring too quickly.</p> <h4 id="path-generation">Path Generation</h4> <p>First, vectors <code class="language-plaintext highlighter-rouge">ptsx</code> and <code class="language-plaintext highlighter-rouge">ptsy</code> were created to store the to-be-generated path. They use the last two coordinates from the remaining path from the previous iteration. Then, the (x,y) coordinates are transformed into Frenet (s,d) coordinates for a simpler analysis.</p> <p>A spline (from <code class="language-plaintext highlighter-rouge">spline.h</code>) is used to create a smooth path in Frenet coordinates using the transformed points. By interpolating the distance between initial and final points, an approximate velocity can be calculated (as successive points are executed at 50 Hz).</p> <p>Finally, the points are converted back to cartesian coordinates to match the global map. 50 points in total are generated (after including the previous remaining path’s residual points). This is then sent to the simulator through JSON files for the car to execute the positions based on the generated path.</p> <h3 id="output">Output</h3> <p>An example of the path planning algorithm in action within the simulator is shown below:</p> <p>Safely driving for more than 7.5 miles:</p> <div class="col-sm mt-3 mt-md-0" align="center"> <figure> <picture> <img src="/assets/img/path_planning/result.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="twiddle" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Result </div> <p>The complete video can be seen from the YouTube link below. Please take note that I speed up the video 2x.</p> <ul> <li>Result: <a href="https://youtu.be/yzNIplAPO2w" target="_blank" rel="noopener noreferrer">https://youtu.be/yzNIplAPO2w</a> </li> </ul> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2022 Evan Febrianto. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>